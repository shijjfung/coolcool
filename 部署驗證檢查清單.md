# 部署驗證檢查清單

## 🔍 404 錯誤：DEPLOYMENT_NOT_FOUND

如果您看到這個錯誤，可能是因為：

1. **Vercel 還沒有部署最新的程式碼**
2. **部署失敗**
3. **訪問的 URL 不正確**

---

## ✅ 解決步驟

### 步驟 1：確認程式碼已推送到 GitHub

1. 前往 GitHub：https://github.com/shijjfung/coolcool
2. 確認分支 `chore-project-review-WQeEy` 存在
3. 確認最新的提交包含：
   - `pages/api/cron/facebook-token-refresh.ts`
   - `pages/api/facebook/refresh-token.ts`
   - `pages/api/facebook/token-status.ts`
   - `pages/api/facebook/auto-refresh-deploy.ts`
   - `vercel.json`（包含 Cron Job 設定）

### 步驟 2：確認 Vercel 已連接 GitHub

1. 前往 Vercel Dashboard
2. 點擊您的專案
3. 前往 **Settings** > **Git**
4. 確認已連接正確的 GitHub 儲存庫和分支

### 步驟 3：手動觸發部署

如果 Vercel 沒有自動部署：

1. 前往 Vercel Dashboard > **Deployments**
2. 點擊 **Create Deployment**
3. 選擇：
   - **Git Repository**：選擇您的 GitHub 儲存庫
   - **Branch**：選擇 `chore-project-review-WQeEy` 或合併到主分支
   - **Framework Preset**：Next.js
4. 點擊 **Deploy**
5. 等待部署完成（1-3 分鐘）

### 步驟 4：確認部署成功

部署完成後：

1. 檢查部署狀態是否為 **Ready**（綠色）
2. 查看 **Functions** 標籤，確認以下 API 存在：
   - `/api/cron/facebook-token-refresh`
   - `/api/facebook/refresh-token`
   - `/api/facebook/token-status`
   - `/api/facebook/auto-refresh-deploy`

### 步驟 5：測試 API

部署完成後，測試以下 API：

1. **檢查 Token 狀態**：
   ```
   https://your-domain.vercel.app/api/facebook/token-status
   ```
   應該返回 Token 狀態資訊

2. **手動觸發自動刷新**（測試用）：
   ```
   https://your-domain.vercel.app/api/cron/facebook-token-refresh
   ```
   應該返回刷新結果

---

## 🔧 如果還是 404

### 檢查事項：

1. **確認檔案路徑正確**
   - 檔案應該在：`pages/api/cron/facebook-token-refresh.ts`
   - 不是：`pages/api/cron/facebook-token-refresh.js`

2. **確認 vercel.json 設定正確**
   ```json
   {
     "crons": [
       {
         "path": "/api/cron/facebook-token-refresh",
         "schedule": "0 2 * * *"
       }
     ]
   }
   ```

3. **檢查 Vercel Logs**
   - 前往 Vercel Dashboard > **Deployments**
   - 點擊最新的部署
   - 查看 **Functions** > **Logs**
   - 搜尋錯誤訊息

4. **確認環境變數已設定**
   - `FACEBOOK_APP_ID`
   - `FACEBOOK_APP_SECRET`
   - `FACEBOOK_ACCESS_TOKEN`
   - `VERCEL_TOKEN`
   - `VERCEL_PROJECT_ID`

---

## 📝 建議操作

如果您的程式碼在 `chore-project-review-WQeEy` 分支：

1. **合併到主分支**（推薦）：
   ```bash
   git checkout main
   git merge chore-project-review-WQeEy
   git push origin main
   ```
   這樣 Vercel 會自動部署主分支

2. **或在 Vercel 設定中指定分支**：
   - 前往 Vercel Dashboard > **Settings** > **Git**
   - 設定 **Production Branch** 為 `chore-project-review-WQeEy`

---

## ✅ 完成後

部署成功後，系統會：
- ✅ 每天自動檢查 Token 狀態
- ✅ 自動刷新即將到期的 Token
- ✅ 自動更新環境變數
- ✅ 自動觸發部署

