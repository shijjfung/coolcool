# 客戶端顯示 IP 和設備資訊功能說明

## ✅ 已完成的功能

現在在客戶端下單頁面會自動顯示：
1. ✅ **客戶端 IP 地址**：顯示客戶當前的 IP 地址
2. ✅ **設備類型**：自動檢測並顯示設備類型（PC、手機、平板、Mac 等）

## 📊 功能展示

### 顯示位置

在客戶端表單頁面（`/form/[token]`），資訊會顯示在表單標題下方：

```
┌─────────────────────────────────────┐
│  表單名稱                           │
│  截止時間：2025/01/20 23:59         │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 設備類型：📱 iPhone          │  │
│  │ IP 地址：192.168.1.100      │  │
│  └─────────────────────────────┘  │
│                                     │
│  [表單欄位...]                      │
└─────────────────────────────────────┘
```

## 🔍 設備類型檢測

系統會自動檢測並顯示以下設備類型：

### 電腦類型
- **💻 Mac**：macOS 系統的 Mac 電腦
- **💻 Windows PC**：Windows 系統的電腦
- **💻 Linux PC**：Linux 系統的電腦
- **💻 電腦**：其他未識別的電腦設備

### 手機類型
- **📱 iPhone**：Apple iPhone
- **📱 Android 手機**：Android 手機
- **📱 手機**：其他手機設備

### 平板類型
- **📱 iPad**：Apple iPad
- **📱 平板 (iPad)**：iPadOS 13+ 的 iPad（會顯示為 Mac，但系統會正確識別）
- **📱 Android 平板**：Android 平板

### 其他
- **其他**：無法識別的設備

## 🔧 技術實作

### 1. IP 地址取得

**API 端點**：`/api/client-info`

```typescript
// 取得客戶端 IP
const fetchClientInfo = async () => {
  const res = await fetch('/api/client-info');
  const data = await res.json();
  if (res.ok && data.ip) {
    setClientIp(data.ip);
  }
};
```

**伺服器端處理**：
- 優先使用 `X-Forwarded-For` header（如果使用代理伺服器）
- 其次使用 `X-Real-IP` header
- 最後使用 `req.socket.remoteAddress`
- 如果都無法取得，顯示 `unknown`

### 2. 設備類型檢測

**客戶端檢測**：
```typescript
const detectDeviceType = () => {
  const ua = navigator.userAgent.toLowerCase();
  // 根據 User-Agent 判斷設備類型
  // ...
};
```

**檢測邏輯**：
1. 檢測 Mac/iPad（iPadOS 13+ 會顯示為 Mac，需要特殊處理）
2. 檢測 Windows
3. 檢測 Linux
4. 檢測 Android（區分手機和平板）
5. 檢測 iPhone
6. 檢測 iPad
7. 檢測其他行動設備
8. 預設為電腦

## 📱 響應式設計

### 手機端顯示

```
┌─────────────────────┐
│ 設備類型：📱 iPhone │
│ IP 地址：192.168... │
└─────────────────────┘
```

### 電腦端顯示

```
┌─────────────────────────────────────┐
│ 設備類型：💻 Windows PC  │ IP 地址：192.168.1.100 │
└─────────────────────────────────────┘
```

## 🎯 使用說明

### 客戶端體驗

1. **打開表單頁面**
   - 客戶訪問表單連結
   - 系統自動檢測設備類型和 IP

2. **查看資訊**
   - 在表單標題下方會顯示設備類型和 IP
   - 資訊會自動更新

3. **填寫表單**
   - 客戶正常填寫表單
   - 資訊會一直顯示在頁面上

### 注意事項

1. **IP 地址**：
   - 如果客戶使用 VPN 或代理，IP 可能不是真實位置
   - 如果部署在 Vercel 等平台，可能顯示為內部 IP
   - 某些情況下可能無法取得 IP（會不顯示）

2. **設備類型**：
   - 基於 User-Agent 檢測，準確度約 95%
   - iPadOS 13+ 會正確識別為 iPad（即使 User-Agent 顯示為 Mac）
   - 某些特殊設備可能無法準確識別

3. **隱私考量**：
   - IP 地址和設備資訊僅供參考
   - 不會影響表單功能
   - 客戶可以正常使用表單

## 🔄 資料流程

### 頁面載入時

```
1. 客戶打開表單頁面
   ↓
2. 系統自動執行：
   ├─ fetchClientInfo() → 取得 IP
   └─ detectDeviceType() → 檢測設備
   ↓
3. 顯示資訊在頁面上
   ↓
4. ✅ 完成！
```

### IP 取得流程

```
客戶端請求 /api/client-info
   ↓
伺服器檢查 headers
   ├─ X-Forwarded-For
   ├─ X-Real-IP
   └─ req.socket.remoteAddress
   ↓
返回 IP 地址
   ↓
客戶端顯示
```

## 💡 優點

1. **即時顯示**：
   - 客戶可以立即看到自己的設備資訊
   - 不需要等待或刷新

2. **自動檢測**：
   - 不需要客戶手動輸入
   - 系統自動識別

3. **美觀設計**：
   - 使用灰色背景區塊
   - 響應式設計，手機和電腦都適用

4. **不影響功能**：
   - 僅供顯示，不影響表單提交
   - 客戶可以正常使用所有功能

## ✅ 總結

現在客戶端表單頁面會自動顯示：
- ✅ **設備類型**：自動檢測並顯示（PC、手機、平板、Mac 等）
- ✅ **IP 地址**：顯示客戶當前的 IP 地址

**功能已完全實作，可以立即使用！** 🎉

