# 設定每 1 分鐘掃描 Facebook 留言

## ⚠️ 重要提醒

實際掃描間隔由**兩個地方**共同決定：

1. **cron-job.org 的觸發頻率**（每 1 分鐘）
2. **表單設定中的掃描間隔**（在建立表單時設定）

系統會取**較大值**，所以兩個地方都要設定！

## 設定步驟

### 步驟 1：在 cron-job.org 設定

1. 在 cron-job.org 的任務設定中：
   - **排程（Schedule）**: 選擇 "每 X 分鐘"
   - **分鐘數（Minutes）**: 輸入 `1`

### 步驟 2：在表單設定中調整掃描間隔

1. 前往後台管理頁面
2. 編輯您的表單（或建立新表單）
3. 找到 **"掃描間隔（分鐘）"** 欄位
4. 將數值改為 `1`
5. 儲存表單

## 注意事項

### 1. 掃描間隔限制

- **最小間隔**：1 分鐘
- **最大間隔**：60 分鐘
- **建議**：不要設定太頻繁（每 1 分鐘），因為：
  - Facebook API 有速率限制
  - 可能增加伺服器負擔
  - 建議至少 3 分鐘以上

### 2. 實際執行邏輯

系統會檢查：
- 距離上次掃描是否已達到設定的間隔時間
- 如果未達到，會跳過本次掃描
- 如果已達到，才會執行掃描

**範例**：
- cron-job.org 設定：每 1 分鐘觸發
- 表單設定：掃描間隔 3 分鐘
- **實際結果**：每 3 分鐘掃描一次（取較大值）

### 3. 如果兩個設定不一致

- cron-job.org：每 1 分鐘觸發
- 表單設定：掃描間隔 5 分鐘
- **實際結果**：每 5 分鐘掃描一次（系統會跳過未達間隔的觸發）

## 推薦設定

### 方案 A：快速掃描（每 1 分鐘）
- cron-job.org：每 1 分鐘
- 表單設定：掃描間隔 1 分鐘
- **優點**：最快捕捉新留言
- **缺點**：增加 API 呼叫次數

### 方案 B：平衡設定（每 3 分鐘）⭐ 推薦
- cron-job.org：每 3 分鐘
- 表單設定：掃描間隔 3 分鐘
- **優點**：平衡速度和資源使用
- **缺點**：無

### 方案 C：節省資源（每 5 分鐘）
- cron-job.org：每 5 分鐘
- 表單設定：掃描間隔 5 分鐘
- **優點**：減少 API 呼叫
- **缺點**：留言處理較慢

## 如何確認設定是否生效

1. **檢查 cron-job.org 執行記錄**：
   - 應該每 1 分鐘有一次執行記錄

2. **檢查 Vercel Function Logs**：
   - 前往 Vercel Dashboard > Functions
   - 查看 `/api/cron/facebook-monitor` 的執行記錄
   - 應該每 1 分鐘有一次（但實際掃描可能因為表單設定而跳過）

3. **檢查實際掃描記錄**：
   - 查看 `/api/facebook/scan-comments` 的執行記錄
   - 應該按照表單設定的間隔執行

## 測試建議

1. 在 Facebook 貼文下留言 "+1"
2. 等待 1-2 分鐘
3. 檢查後台是否有新訂單
4. 如果沒有，可能是：
   - 表單設定的掃描間隔還沒到
   - 留言不符合關鍵字
   - 其他設定問題

