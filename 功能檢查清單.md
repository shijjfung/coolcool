# Facebook å’Œ LINE è‡ªå‹•ç›£æ§åŠŸèƒ½æª¢æŸ¥æ¸…å–®

## âœ… Facebook è‡ªå‹•ç›£æ§åŠŸèƒ½

### éœ€æ±‚ vs å¯¦ä½œå°ç…§

| éœ€æ±‚ | å¯¦ä½œç‹€æ…‹ | èªªæ˜ |
|------|---------|------|
| æ ¹æ“šè²¼æ–‡å…§å®¹è­˜åˆ¥è¦ç›£æ§çš„è²¼æ–‡ | âœ… å·²å¯¦ä½œ | ç”¨æˆ¶æä¾›è²¼æ–‡é€£çµï¼Œç³»çµ±è§£æ |
| å¯é…ç½®çš„é—œéµå­—ï¼ˆä¸æ˜¯å¯«æ­»çš„ï¼‰ | âœ… å·²å¯¦ä½œ | åœ¨è¡¨å–®å»ºç«‹é é¢å¯è‡ªè¨‚é—œéµå­— |
| æ¯3åˆ†é˜æƒæç•™è¨€ | âš ï¸ éƒ¨åˆ†å¯¦ä½œ | æœ‰ cron jobï¼Œä½†éœ€è¦ç¢ºèªæ˜¯å¦åœ¨ vercel.json ä¸­è¨­å®š |
| è‡ªå‹•å›è¦†ç•™è¨€ | âœ… å·²å¯¦ä½œ | ä½¿ç”¨ `replyToFacebookComment` å‡½æ•¸ |
| ä½¿ç”¨å›è¦†ç•™è¨€çš„å¸³è™Ÿï¼ˆHelper Accountï¼‰ | âœ… å·²å¯¦ä½œ | ä½¿ç”¨ `FACEBOOK_ACCESS_TOKEN` |
| çµå–®æ™‚é–“åˆ°å°±åœæ­¢æŠ“å– | âœ… å·²å¯¦ä½œ | æª¢æŸ¥ `order_deadline` æˆ– `deadline` |

### éœ€è¦ç¢ºèªçš„äº‹é …

1. **Cron Job è¨­å®š**ï¼šéœ€è¦ç¢ºèª `vercel.json` ä¸­æ˜¯å¦æœ‰è¨­å®š Facebook ç›£æ§çš„ cron jobï¼ˆæ¯3åˆ†é˜ï¼‰

---

## âŒ LINE è‡ªå‹•ç›£æ§åŠŸèƒ½ï¼ˆç¼ºå°‘éƒ¨åˆ†åŠŸèƒ½ï¼‰

### éœ€æ±‚ vs å¯¦ä½œå°ç…§

| éœ€æ±‚ | å¯¦ä½œç‹€æ…‹ | èªªæ˜ |
|------|---------|------|
| ç•¶ç™¼æ–‡è€…POè³£æ–‡æ™‚ï¼ŒBotç«‹å³å›æ‡‰ç¢ºèªè¨Šæ¯ | âŒ **æœªå¯¦ä½œ** | ç¼ºå°‘è³£æ–‡æª¢æ¸¬åŠŸèƒ½ |
| å¯é…ç½®çš„é—œéµå­— | âœ… å·²å¯¦ä½œ | åœ¨è¡¨å–®å»ºç«‹é é¢å¯è‡ªè¨‚é—œéµå­— |
| è‡ªå‹•æŠ“å–ç•™è¨€ä¸¦å›è¦†ã€Œå·²ç™»è¨˜ã€ | âš ï¸ éƒ¨åˆ†å¯¦ä½œ | æœ‰å›è¦†åŠŸèƒ½ï¼Œä½†ç¼ºå°‘ä¸Šä¸‹æ–‡é—œè¯ |
| éœ€è¦ä¸Šä¸‹æ–‡é—œè¯ï¼ˆè­˜åˆ¥å“ªå€‹è³£æ–‡ï¼‰ | âŒ **æœªå¯¦ä½œ** | ç¼ºå°‘ `getRecentLinePosts` çš„ä½¿ç”¨ |
| éœ€è¦æŒ‡å®šç™¼æ–‡è€…å§“å | âœ… å·²å¯¦ä½œ | æœ‰ `line_post_author` æ¬„ä½ |
| çµå–®æ™‚é–“åˆ°å°±åœæ­¢ | âœ… å·²å¯¦ä½œ | æª¢æŸ¥ `deadline` |

### ç¼ºå°‘çš„åŠŸèƒ½

1. **è³£æ–‡æª¢æ¸¬**ï¼š
   - ç•¶ `line_post_author` ç™¼é€è³£æ–‡æ™‚ï¼ŒBot æ‡‰è©²ç«‹å³å›æ‡‰ï¼šã€Œå°å¹«æ‰‹å·²ç¶“æ”¶åˆ°é—†å¨˜è¦æˆ‘ä¸Šç­çš„è¨Šæ¯æ‹‰ï¼Œå°å¹«æ‰‹è¦ä¸Šé–‹å§‹ä¸Šç­å•¦!_!ã€
   - éœ€è¦æª¢æ¸¬è³£æ–‡é—œéµå­—ï¼ˆä¾‹å¦‚ï¼šå•†å“ã€åƒ¹æ ¼ã€çµå–®ç­‰ï¼‰
   - éœ€è¦è¨˜éŒ„è³£æ–‡åˆ° `line_posts` è¡¨

2. **ä¸Šä¸‹æ–‡é—œè¯**ï¼š
   - ç•¶å®¢æˆ¶ç•™è¨€æ™‚ï¼Œéœ€è¦æ ¹æ“šæœ€è¿‘çš„è³£æ–‡ä¾†åˆ¤æ–·æ‡‰è©²å°æ‡‰åˆ°å“ªå€‹è¡¨å–®
   - ä½¿ç”¨ `getRecentLinePosts` ä¾†å–å¾—æœ€è¿‘çš„è³£æ–‡è¨˜éŒ„
   - æ ¹æ“šè³£æ–‡è¨˜éŒ„ä¾†åŒ¹é…è¡¨å–®

3. **è‡ªå‹•å›è¦†ã€Œå·²ç™»è¨˜ã€**ï¼š
   - ç•¶ç¬¦åˆé—œéµå­—çš„ç•™è¨€è¢«è™•ç†å¾Œï¼Œæ‡‰è©²å›è¦†ã€Œå·²ç™»è¨˜ã€ï¼ˆè€Œä¸æ˜¯ç›®å‰çš„è©³ç´°è¨‚å–®è³‡è¨Šï¼‰

---

## ğŸ“‹ éœ€è¦è£œå……çš„å¯¦ä½œ

### 1. LINE è³£æ–‡æª¢æ¸¬åŠŸèƒ½

åœ¨ `pages/api/webhook/line.ts` ä¸­éœ€è¦æ·»åŠ ï¼š

```typescript
// æª¢æ¸¬æ˜¯å¦ç‚ºè³£æ–‡
const isSellingPost = (message: string, senderName: string, linePostAuthor: string) => {
  // æª¢æŸ¥ç™¼æ–‡è€…æ˜¯å¦åŒ¹é…
  if (senderName !== linePostAuthor) return false;
  
  // æª¢æŸ¥æ˜¯å¦åŒ…å«è³£æ–‡é—œéµå­—
  const sellingKeywords = ['å•†å“', 'åƒ¹æ ¼', 'çµå–®', 'è¦çš„', 'åº•ä¸‹ç•™è¨€'];
  const hasKeyword = sellingKeywords.some(keyword => message.includes(keyword));
  
  // æª¢æŸ¥è¨Šæ¯é•·åº¦ï¼ˆè³£æ–‡é€šå¸¸è¼ƒé•·ï¼‰
  const isLongEnough = message.length > 20;
  
  return hasKeyword && isLongEnough;
};

// ç•¶æª¢æ¸¬åˆ°è³£æ–‡æ™‚
if (isSellingPost(messageText, senderName, form.line_post_author)) {
  // è¨˜éŒ„è³£æ–‡
  await recordLinePost(form.id, event.source.groupId!, messageText, senderName);
  
  // ç«‹å³å›æ‡‰ç¢ºèªè¨Šæ¯
  await replyMessage(
    event.replyToken!,
    'å°å¹«æ‰‹å·²ç¶“æ”¶åˆ°é—†å¨˜è¦æˆ‘ä¸Šç­çš„è¨Šæ¯æ‹‰ï¼Œå°å¹«æ‰‹è¦ä¸Šé–‹å§‹ä¸Šç­å•¦!_!',
    channelAccessToken
  );
  continue;
}
```

### 2. LINE ä¸Šä¸‹æ–‡é—œè¯åŠŸèƒ½

åœ¨è™•ç†è¨‚å–®ç•™è¨€æ™‚ï¼Œéœ€è¦ï¼š

```typescript
// å–å¾—æœ€è¿‘çš„è³£æ–‡è¨˜éŒ„
const recentPosts = await getRecentLinePosts(event.source.groupId!);

// æ ¹æ“šè³£æ–‡è¨˜éŒ„ä¾†åŒ¹é…è¡¨å–®
const matchedForm = findBestMatchingForm(messageText, recentPosts, forms);

// å¦‚æœæ‰¾åˆ°åŒ¹é…çš„è¡¨å–®ï¼Œä½¿ç”¨è©²è¡¨å–®å»ºç«‹è¨‚å–®
```

### 3. ç°¡åŒ–å›è¦†è¨Šæ¯

ç•¶ç¬¦åˆé—œéµå­—çš„ç•™è¨€è¢«è™•ç†å¾Œï¼Œæ‡‰è©²å›è¦†ï¼š

```typescript
// å¦‚æœç•™è¨€åŒ…å« +1 ç­‰é—œéµå­—ï¼Œå›è¦†ç°¡çŸ­çš„ã€Œå·²ç™»è¨˜ã€
if (matchesKeywords(messageText, form.line_keywords)) {
  await replyMessage(
    event.replyToken!,
    'å·²ç™»è¨˜',
    channelAccessToken
  );
} else {
  // å¦å‰‡å›è¦†è©³ç´°çš„è¨‚å–®è³‡è¨Š
  await replyMessage(
    event.replyToken!,
    `âœ… è¨‚å–®å·²å»ºç«‹ï¼\n\nå•†å“ï¼š${itemsText}\nè¨‚å–®ä»£ç¢¼ï¼š${orderToken}`,
    channelAccessToken
  );
}
```

---

## ğŸ¯ ç¸½çµ

### Facebook åŠŸèƒ½ï¼šâœ… å®Œæ•´
- æ‰€æœ‰éœ€æ±‚éƒ½å·²å¯¦ä½œ
- åªéœ€è¦ç¢ºèª cron job è¨­å®š

### LINE åŠŸèƒ½ï¼šâš ï¸ ä¸å®Œæ•´
- ç¼ºå°‘è³£æ–‡æª¢æ¸¬åŠŸèƒ½
- ç¼ºå°‘ä¸Šä¸‹æ–‡é—œè¯åŠŸèƒ½
- å›è¦†è¨Šæ¯éœ€è¦ç°¡åŒ–

### å»ºè­°
1. å…ˆç¢ºèª Facebook cron job æ˜¯å¦è¨­å®š
2. è£œå…… LINE è³£æ–‡æª¢æ¸¬åŠŸèƒ½
3. è£œå…… LINE ä¸Šä¸‹æ–‡é—œè¯åŠŸèƒ½
4. ç°¡åŒ– LINE å›è¦†è¨Šæ¯

