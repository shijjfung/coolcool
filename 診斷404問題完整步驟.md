# 診斷 404 問題完整步驟

## 🔍 第一步：確認問題範圍

### 測試 1：簡單 API 是否正常

訪問：`https://coolcool-ten.vercel.app/api/health`

**預期結果**：
```json
{
  "success": true,
  "message": "API 路由正常工作",
  "timestamp": "...",
  "environment": "production"
}
```

**如果也返回 404**：
- ❌ 所有 API 路由都有問題
- 可能是 Vercel 部署配置問題

**如果返回 JSON**：
- ✅ 基本 API 路由正常
- ❌ 問題可能出在嵌套路徑（如 `/api/forms/list`）

---

## 🔍 第二步：檢查 Vercel 函數日誌

### 步驟：

1. **前往 Vercel Dashboard**
   - 訪問：https://vercel.com/dashboard
   - 選擇您的專案：`coolcool-ten`

2. **查看最新部署**
   - 點擊 **Deployments** 標籤
   - 找到最新的部署（應該是最上面的）

3. **查看函數日誌**
   - 點擊最新部署
   - 點擊 **Functions** 標籤（或 **Logs** 標籤）
   - 在瀏覽器中訪問：`https://coolcool-ten.vercel.app/api/forms/list`
   - 查看是否有新的日誌輸出

### 日誌分析：

**如果有日誌輸出**：
- ✅ 函數存在且被調用
- 查看日誌中的錯誤訊息
- 可能是環境變數或資料庫連線問題

**如果沒有日誌輸出**：
- ❌ 函數可能沒有被正確部署
- 需要檢查構建日誌

---

## 🔍 第三步：檢查構建日誌

### 步驟：

1. **在 Vercel Dashboard 中**
   - 點擊最新部署
   - 點擊 **Build Logs** 標籤

2. **查找關鍵資訊**：
   - 搜索：`/api/forms/list`
   - 搜索：`Compiled successfully`
   - 搜索：`Error`

### 預期看到：

```
Route (app)                              Size     First Load JS
┌ ○ /api/forms/list                     123 B    123 B
└ ○ /api/forms/create                   456 B    456 B
```

**如果沒有看到這些路由**：
- ❌ 構建時沒有識別到這些 API 路由
- 可能是文件路徑問題

---

## 🔧 可能的解決方案

### 方案 1：確認文件路徑正確

確認以下文件存在：

- ✅ `pages/api/forms/list.ts`
- ✅ `pages/api/forms/create.ts`
- ✅ `pages/api/health.ts`

### 方案 2：創建 vercel.json 配置

已創建 `vercel.json` 文件，請執行：

1. 執行 `創建vercel.json配置.bat`
2. 在 Vercel Dashboard 中手動觸發重新部署
3. **不要勾選** "Use existing Build Cache"

### 方案 3：檢查環境變數是否正確傳遞

在 Vercel Dashboard 中：

1. 前往 **Settings** → **Environment Variables**
2. 確認三個變數都存在：
   - `DATABASE_TYPE` = `supabase`
   - `SUPABASE_URL` = `https://ceazouzwbvcfwudcbbnk.supabase.co`
   - `SUPABASE_SERVICE_ROLE_KEY` = `eyJhbGci...`
3. 確認每個變數都選擇了 **All Environments**

### 方案 4：強制清除快取並重新部署

1. 在 Vercel Dashboard 中
2. 前往 **Settings** → **Caches**（如果有的話）
3. 清除所有快取
4. 手動觸發重新部署（不勾選 Build Cache）

---

## 📋 請提供以下資訊

請執行以下操作並提供結果：

1. **測試 `/api/health`**：
   - 訪問：`https://coolcool-ten.vercel.app/api/health`
   - 返回什麼？（JSON 還是 404？）

2. **查看 Vercel 函數日誌**：
   - 訪問 `/api/forms/list` 時是否有日誌輸出？
   - 日誌中顯示什麼錯誤？

3. **查看構建日誌**：
   - 是否看到 `/api/forms/list` 在路由列表中？
   - 是否有任何錯誤訊息？

---

## 🎯 下一步

根據測試結果：

- **如果 `/api/health` 也返回 404**：
  - 執行 `創建vercel.json配置.bat`
  - 重新部署

- **如果 `/api/health` 正常，但 `/api/forms/list` 返回 404**：
  - 檢查 Vercel 函數日誌
  - 可能是嵌套路徑問題

- **如果有日誌但顯示錯誤**：
  - 根據錯誤訊息進行修復

---

**請先測試 `/api/health`，然後查看 Vercel 函數日誌！** 🔍

